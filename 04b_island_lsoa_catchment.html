

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>‚ÄúIsland‚Äù catchment areas &#8212; Stroke maps</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=c5ced968eda925caa686" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=c5ced968eda925caa686" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=c5ced968eda925caa686" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=c5ced968eda925caa686" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=c5ced968eda925caa686" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=c5ced968eda925caa686" />
  <script src="_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=c5ced968eda925caa686"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '04b_island_lsoa_catchment';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Colour maps by continuous value" href="05_maps_value.html" />
    <link rel="prev" title="Data reference" href="data_ref.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
  
    <p class="title logo__title">Stroke maps</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">‚≠ê Essentials</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="02_import_data.html">Import geography data</a></li>
<li class="toctree-l1"><a class="reference internal" href="03a_stroke_units.html">Stroke units</a></li>
<li class="toctree-l1"><a class="reference internal" href="03b_transfer_units.html">Transfer units</a></li>
<li class="toctree-l1"><a class="reference internal" href="04a_lsoa_catchment.html">Catchment areas for stroke units</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">üìö Reference data creation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="data_ref.html">Data reference</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚ö° Extras</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">‚ÄúIsland‚Äù catchment areas</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">üåç Plotting examples with matplotlib</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="05_maps_value.html">Colour maps by continuous value</a></li>
<li class="toctree-l1"><a class="reference internal" href="06a_label_units.html">Labelling stroke units</a></li>
<li class="toctree-l1"><a class="reference internal" href="06b_periphery.html">Finding nearby points of interest</a></li>
<li class="toctree-l1"><a class="reference internal" href="06c_clip_and_inset.html">Map insets</a></li>
<li class="toctree-l1"><a class="reference internal" href="06d_colour_catchment.html">Colour catchment areas by transfer unit</a></li>

</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/samuel-modelling/stroke-maps" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/04b_island_lsoa_catchment.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>‚ÄúIsland‚Äù catchment areas</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plain-english-summary">Plain English summary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#aims">Aims</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#method">Method</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#notebook-setup">Notebook setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#load-data">Load data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#functions">Functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#method-1-nearest-stroke-unit">Method 1: nearest stroke unit</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#method-2-island">Method 2: Island</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plots">Plots</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion">Conclusion</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="island-catchment-areas">
<h1>‚ÄúIsland‚Äù catchment areas<a class="headerlink" href="#island-catchment-areas" title="Permalink to this heading">#</a></h1>
<p>This notebook shows an alternative way of considering catchment areas. Instead of using the whole country, limit the allowed stroke units and areas to just those within a selected region.</p>
<section id="plain-english-summary">
<h2>Plain English summary<a class="headerlink" href="#plain-english-summary" title="Permalink to this heading">#</a></h2>
<p>Ordinarily the catchment areas of each stroke unit don‚Äôt match up nicely to other defined regions, for example the Integrated Care Boards or Ambulance Service boundaries.</p>
<p>Sometimes though it‚Äôs preferable to only consider patients within a given region, even if patients outside the border would still ordinarily travel to a stroke unit within that region.</p>
<p>This is like pretending that everything outside the region doesn‚Äôt exist. Outside the region, there are no places with patients who will want to enter the region for treatment. Outside the region, there are no other stroke units that patients within the region might prefer to travel to. When the regions are split off like this, it is as though each one is its own island with nothing else surrounding it.</p>
<p>In this example we will calculate the catchment areas while restricting everything to the ISDN named ‚ÄúWest Midlands‚Äù.</p>
</section>
<section id="aims">
<h2>Aims<a class="headerlink" href="#aims" title="Permalink to this heading">#</a></h2>
<p>Calculate the ‚Äúisland‚Äù style catchment areas in the West Midlands ISDN. Create a map of this style and the normal style for comparison.</p>
</section>
<section id="method">
<h2>Method<a class="headerlink" href="#method" title="Permalink to this heading">#</a></h2>
<p>To create this effect with the catchment code, it is possible to restrict:</p>
<ul class="simple">
<li><p>which stroke units are considered for each LSOA or SA</p></li>
<li><p>which LSOA or SA are considered</p></li>
</ul>
<p>In the ‚Äúisland‚Äù style:</p>
<ul class="simple">
<li><p>Limit the list of stroke units to only those in the selected region</p></li>
<li><p>Limit the list of LSOA to only those in the selected region</p></li>
<li><p>Calculate the chosen stroke units with the lists of restricted stroke units and restricted LSOA</p></li>
</ul>
</section>
<section id="notebook-setup">
<h2>Notebook setup<a class="headerlink" href="#notebook-setup" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">stroke_maps.load_data</span>
<span class="kn">import</span> <span class="nn">stroke_maps.catchment</span>
<span class="kn">import</span> <span class="nn">stroke_maps.geo</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">mapclassify</span> <span class="kn">import</span> <span class="n">greedy</span>  <span class="c1"># to assign colours to regions on map.</span>
                                <span class="c1"># ^ also requires libpysal.</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="load-data">
<h2>Load data<a class="headerlink" href="#load-data" title="Permalink to this heading">#</a></h2>
<p><strong>Stroke unit services</strong> for the calculations and <strong>coordinates</strong> for the maps</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_units</span> <span class="o">=</span> <span class="n">stroke_maps</span><span class="o">.</span><span class="n">load_data</span><span class="o">.</span><span class="n">stroke_unit_region_lookup</span><span class="p">()</span>

<span class="n">gdf_units</span> <span class="o">=</span> <span class="n">stroke_maps</span><span class="o">.</span><span class="n">load_data</span><span class="o">.</span><span class="n">stroke_unit_coordinates</span><span class="p">()</span>
<span class="c1"># Merge the services information into the coordinates:</span>
<span class="n">gdf_units</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
    <span class="n">gdf_units</span><span class="p">,</span> <span class="n">df_units</span><span class="p">[[</span><span class="s1">&#39;use_ivt&#39;</span><span class="p">,</span> <span class="s1">&#39;use_mt&#39;</span><span class="p">]],</span>
    <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;right&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>LSOA travel time</strong> for the calculations</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_travel_lsoa</span> <span class="o">=</span> <span class="n">stroke_maps</span><span class="o">.</span><span class="n">load_data</span><span class="o">.</span><span class="n">travel_time_matrix_lsoa</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p><strong>LSOA boundaries</strong> for the maps</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf_lsoa</span> <span class="o">=</span> <span class="n">stroke_maps</span><span class="o">.</span><span class="n">load_data</span><span class="o">.</span><span class="n">lsoa_geography</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p><strong>ISDN boundaries</strong> for the maps</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf_isdn</span> <span class="o">=</span> <span class="n">stroke_maps</span><span class="o">.</span><span class="n">load_data</span><span class="o">.</span><span class="n">isdn_geography</span><span class="p">()</span>
<span class="c1"># Only keep the chosen region:</span>
<span class="n">gdf_isdn</span> <span class="o">=</span> <span class="n">gdf_isdn</span><span class="p">[</span><span class="n">gdf_isdn</span><span class="p">[</span><span class="s1">&#39;isdn&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;West Midlands&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="functions">
<h2>Functions<a class="headerlink" href="#functions" title="Permalink to this heading">#</a></h2>
<p>Define functions that will be used to create catchment area boundaries and plot the map for both methods in the same way.</p>
<p>The following function creates the catchment area boundaries for the map. It has the same setup as the previous LSOA catchment documentation. <strong>TO DO: add link</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">make_gdf</span><span class="p">(</span>
        <span class="n">df_catchment_acute</span><span class="p">,</span>  <span class="c1"># Contains LSOA-unit link.</span>
        <span class="n">gdf_lsoa</span>
        <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make a GeoDataFrame of stroke unit catchment areas.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">gdf_lsoa_acute</span> <span class="o">=</span> <span class="n">gdf_lsoa</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    
    <span class="c1"># Merge in the information on nearest acute stroke unit:</span>
    <span class="n">gdf_lsoa_acute</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
        <span class="n">gdf_lsoa_acute</span><span class="p">,</span> <span class="n">df_catchment_acute</span><span class="p">[</span><span class="s1">&#39;unit_postcode&#39;</span><span class="p">],</span>
        <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;LSOA11NM&#39;</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;right&#39;</span>
    <span class="p">)</span>
    <span class="c1"># Combine LSOA with the same acute stroke unit into a single region:</span>
    <span class="n">gdf_catchment_acute</span> <span class="o">=</span> <span class="n">stroke_maps</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">combine_regions</span><span class="p">(</span><span class="n">gdf_lsoa_acute</span><span class="p">,</span> <span class="s1">&#39;unit_postcode&#39;</span><span class="p">)</span>
    <span class="c1"># Convert the coordinates to British National Grid so that they match other geometry:</span>
    <span class="n">gdf_catchment_acute</span> <span class="o">=</span> <span class="n">gdf_catchment_acute</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="s1">&#39;EPSG:27700&#39;</span><span class="p">)</span>
    <span class="c1"># Assign colours:</span>
    <span class="n">gdf_catchment_acute</span><span class="p">[</span><span class="s1">&#39;adjacent_colours&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">greedy</span><span class="p">(</span>
        <span class="n">gdf_catchment_acute</span><span class="p">,</span> <span class="n">min_distance</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">balance</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="c1"># Assign these colours to the regions:</span>
    <span class="n">gdf_catchment_acute</span><span class="p">[</span><span class="s1">&#39;colour_str&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_catchment_acute</span><span class="p">[</span><span class="s1">&#39;adjacent_colours&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">colour_map</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">gdf_catchment_acute</span>
</pre></div>
</div>
</div>
</div>
<p>The following function plots the map:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_catchment</span><span class="p">(</span>
        <span class="n">gdf_catchment</span><span class="p">,</span>
        <span class="n">gdf_isdn</span><span class="p">,</span>
        <span class="n">gdf_units</span><span class="p">,</span>
        <span class="n">postcodes_used</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="n">bounds</span><span class="o">=</span><span class="p">[]</span>
    <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot catchment areas, stroke units, and ISDN boundary.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    
    <span class="c1"># Catchment areas:</span>
    <span class="n">gdf_catchment</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>              <span class="c1"># Set which axes to use for plot</span>
        <span class="n">antialiased</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Avoids artefact boundary lines</span>
        <span class="n">color</span><span class="o">=</span><span class="n">gdf_catchment</span><span class="p">[</span><span class="s1">&#39;colour_str&#39;</span><span class="p">],</span>  <span class="c1"># set colours using this column</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
        <span class="p">)</span>
    
    <span class="c1"># Setup for ISDN:</span>
    <span class="n">kwargs_isdn</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
        <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c1"># ISDN outlines:</span>
    <span class="n">gdf_isdn</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>              <span class="c1"># Set which axes to use for plot</span>
        <span class="n">antialiased</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Avoids artefact boundary lines</span>
        <span class="o">**</span><span class="n">kwargs_isdn</span>
        <span class="p">)</span>
    <span class="c1"># Can&#39;t put regions like this ^ in the legend, so fake it now.</span>
    <span class="c1"># Draw an area so small you&#39;ll never see it</span>
    <span class="c1"># and give it the same properties as the wanted region.</span>
    <span class="n">points</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">gdf_isdn</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">coords</span><span class="p">]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span>
        <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="o">+</span><span class="mf">1e-7</span><span class="p">],</span>
        <span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mf">1e-7</span><span class="p">],</span>
        <span class="o">**</span><span class="n">kwargs_isdn</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;West Midlands ISDN&#39;</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">postcodes_used</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># Limit the stroke units to only the ones used:</span>
        <span class="n">gdf_units</span> <span class="o">=</span> <span class="n">gdf_units</span><span class="p">[</span><span class="n">gdf_units</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">postcodes_used</span><span class="p">)]</span>
    <span class="c1"># Pick out which stroke units to plot:</span>
    <span class="n">mask_ivt</span> <span class="o">=</span> <span class="p">((</span><span class="n">gdf_units</span><span class="p">[</span><span class="s1">&#39;use_ivt&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">gdf_units</span><span class="p">[</span><span class="s1">&#39;use_mt&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">mask_mt</span> <span class="o">=</span> <span class="p">(</span><span class="n">gdf_units</span><span class="p">[</span><span class="s1">&#39;use_mt&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
    
    <span class="c1"># IVT units:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
        <span class="n">gdf_units</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask_ivt</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
        <span class="n">gdf_units</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask_ivt</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
        <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
        <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;IVT unit&#39;</span><span class="p">,</span>
        <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>  <span class="c1"># size</span>
        <span class="p">)</span>
    
    <span class="c1"># MT units:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
        <span class="n">gdf_units</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask_mt</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
        <span class="n">gdf_units</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask_mt</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
        <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span>
        <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;MT unit&#39;</span><span class="p">,</span>
        <span class="n">s</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>  <span class="c1"># size</span>
        <span class="p">)</span>

    <span class="c1"># Axis limits:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bounds</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

    <span class="c1"># Remove the axis ticks</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    
    <span class="c1"># Add legend:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>The following colour list is used to colour the catchment areas in the maps.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make a list of colour names:</span>
<span class="c1"># Expecting to only need a few colours for this example.</span>
<span class="n">colours</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Indigo&#39;</span><span class="p">,</span> <span class="s1">&#39;Purple&#39;</span><span class="p">,</span> <span class="s1">&#39;DarkOrchid&#39;</span><span class="p">,</span> <span class="s1">&#39;MediumOrchid&#39;</span><span class="p">,</span> <span class="s1">&#39;Orchid&#39;</span><span class="p">,</span> <span class="s1">&#39;Plum&#39;</span><span class="p">,</span> <span class="s1">&#39;Lavender&#39;</span><span class="p">]</span>

<span class="c1"># Make a dictionary of numbers to colours.</span>
<span class="c1"># The keys are the numbers in the `adjacent_colours` column:</span>
<span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">colours</span><span class="p">))]</span>
<span class="n">colour_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">colours</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="method-1-nearest-stroke-unit">
<h2>Method 1: nearest stroke unit<a class="headerlink" href="#method-1-nearest-stroke-unit" title="Permalink to this heading">#</a></h2>
<p>First we‚Äôll create a map of the normal stroke unit catchment areas in the West Midlands when we don‚Äôt restrict anything.</p>
<p>Limit the travel time matrix to only stroke units that offer acute care. These are units where <code class="docutils literal notranslate"><span class="pre">use_ivt</span></code> and/or <code class="docutils literal notranslate"><span class="pre">use_mt</span></code> are equal to 1 (one).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mask_acute</span> <span class="o">=</span> <span class="p">((</span><span class="n">df_units</span><span class="p">[</span><span class="s1">&#39;use_ivt&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">df_units</span><span class="p">[</span><span class="s1">&#39;use_mt&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">postcodes_acute_units</span> <span class="o">=</span> <span class="n">df_units</span><span class="p">[</span><span class="n">mask_acute</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># Load the travel time matrix:</span>
<span class="n">df_travel_lsoa</span> <span class="o">=</span> <span class="n">stroke_maps</span><span class="o">.</span><span class="n">load_data</span><span class="o">.</span><span class="n">travel_time_matrix_lsoa</span><span class="p">()</span>
<span class="c1"># Limit it to these units:</span>
<span class="n">df_travel_lsoa_acute</span> <span class="o">=</span> <span class="n">df_travel_lsoa</span><span class="p">[</span><span class="n">postcodes_acute_units</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Run the function to find which of the units in the reduced dataframe is closest to each LSOA:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_catchment_acute</span> <span class="o">=</span> <span class="n">stroke_maps</span><span class="o">.</span><span class="n">catchment</span><span class="o">.</span><span class="n">find_nearest_unit</span><span class="p">(</span><span class="n">df_travel_lsoa_acute</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Limit this results dataframe to only stroke units in the chosen region:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Which postcodes are in the chosen region?</span>
<span class="n">mask_here</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_units</span><span class="p">[</span><span class="s1">&#39;isdn&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;West Midlands&#39;</span><span class="p">)</span>
<span class="n">postcodes_here</span> <span class="o">=</span> <span class="n">df_units</span><span class="p">[</span><span class="n">mask_here</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># Limit the catchment data to only those postcodes:</span>
<span class="n">mask_catchment</span> <span class="o">=</span> <span class="n">df_catchment_acute</span><span class="p">[</span><span class="s1">&#39;unit_postcode&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">postcodes_here</span><span class="p">)</span>
<span class="n">df_catchment_acute</span> <span class="o">=</span> <span class="n">df_catchment_acute</span><span class="p">[</span><span class="n">mask_catchment</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>This dataframe is allowed to contain LSOA outside the selected region and to not contain LSOA within the selected region.</p>
</section>
<section id="method-2-island">
<h2>Method 2: Island<a class="headerlink" href="#method-2-island" title="Permalink to this heading">#</a></h2>
<p>Next we‚Äôll create the catchment areas when considering only LSOA and stroke units within the chosen region.</p>
<p>Limit the travel time matrix to only the stroke units offering acute care and in the chosen region.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mask_units</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">df_units</span><span class="p">[</span><span class="s1">&#39;isdn&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;West Midlands&#39;</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="p">(</span><span class="n">df_units</span><span class="p">[</span><span class="s1">&#39;use_ivt&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">df_units</span> <span class="o">=</span> <span class="n">df_units</span><span class="p">[</span><span class="n">mask_units</span><span class="p">]</span>
<span class="n">postcodes_island</span> <span class="o">=</span> <span class="n">df_units</span><span class="o">.</span><span class="n">index</span>

<span class="c1"># Load the travel time matrix:</span>
<span class="n">df_travel_lsoa</span> <span class="o">=</span> <span class="n">stroke_maps</span><span class="o">.</span><span class="n">load_data</span><span class="o">.</span><span class="n">travel_time_matrix_lsoa</span><span class="p">()</span>
<span class="c1"># Limit it to these units:</span>
<span class="n">df_travel_lsoa_here</span> <span class="o">=</span> <span class="n">df_travel_lsoa</span><span class="o">.</span><span class="n">copy</span><span class="p">()[</span><span class="n">df_units</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Link LSOA names to the ISDN that contains them.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the LSOA-region lookup data:</span>
<span class="n">df_lsoa_regions</span> <span class="o">=</span> <span class="n">stroke_maps</span><span class="o">.</span><span class="n">load_data</span><span class="o">.</span><span class="n">lsoa_region_lookup</span><span class="p">()</span>
<span class="n">df_regions</span> <span class="o">=</span> <span class="n">stroke_maps</span><span class="o">.</span><span class="n">load_data</span><span class="o">.</span><span class="n">region_lookup</span><span class="p">()</span>

<span class="c1"># Merge the ISDN names into the LSOA-region lookup:</span>
<span class="n">df_lsoa_regions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
    <span class="n">df_lsoa_regions</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span>
    <span class="n">df_regions</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()[[</span><span class="s1">&#39;region_code&#39;</span><span class="p">,</span> <span class="s1">&#39;isdn&#39;</span><span class="p">]],</span>
    <span class="n">on</span><span class="o">=</span><span class="s1">&#39;region_code&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Limit the travel time matrix to only the LSOAs in the chosen region:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mask_lsoa</span> <span class="o">=</span> <span class="n">df_lsoa_regions</span><span class="p">[</span><span class="s1">&#39;isdn&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;West Midlands&#39;</span>
<span class="n">df_lsoa_regions</span> <span class="o">=</span> <span class="n">df_lsoa_regions</span><span class="p">[</span><span class="n">mask_lsoa</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Limit the travel time matrix to only these LSOA:</span>
<span class="n">mask_travel</span> <span class="o">=</span> <span class="n">df_travel_lsoa_here</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">df_lsoa_regions</span><span class="p">[</span><span class="s1">&#39;lsoa&#39;</span><span class="p">])</span>
<span class="n">df_travel_lsoa_here</span> <span class="o">=</span> <span class="n">df_travel_lsoa_here</span><span class="p">[</span><span class="n">mask_travel</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Resulting travel matrix:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_travel_lsoa_here</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CV22DX</th>
      <th>HR12ER</th>
      <th>B152TH</th>
      <th>WR51DD</th>
    </tr>
    <tr>
      <th>LSOA</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Birmingham 001A</th>
      <td>36.9</td>
      <td>84.2</td>
      <td>31.6</td>
      <td>47.7</td>
    </tr>
    <tr>
      <th>Birmingham 001B</th>
      <td>36.9</td>
      <td>85.3</td>
      <td>33.7</td>
      <td>49.8</td>
    </tr>
    <tr>
      <th>Birmingham 001C</th>
      <td>38.0</td>
      <td>84.2</td>
      <td>32.6</td>
      <td>48.8</td>
    </tr>
    <tr>
      <th>Birmingham 001D</th>
      <td>36.9</td>
      <td>85.3</td>
      <td>33.7</td>
      <td>49.8</td>
    </tr>
    <tr>
      <th>Birmingham 002A</th>
      <td>35.9</td>
      <td>85.3</td>
      <td>33.7</td>
      <td>49.8</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>Wyre Forest 013D</th>
      <td>64.9</td>
      <td>57.4</td>
      <td>38.0</td>
      <td>26.2</td>
    </tr>
    <tr>
      <th>Wyre Forest 014A</th>
      <td>64.9</td>
      <td>52.0</td>
      <td>38.0</td>
      <td>26.2</td>
    </tr>
    <tr>
      <th>Wyre Forest 014B</th>
      <td>65.9</td>
      <td>52.0</td>
      <td>39.1</td>
      <td>27.3</td>
    </tr>
    <tr>
      <th>Wyre Forest 014C</th>
      <td>65.9</td>
      <td>50.9</td>
      <td>39.1</td>
      <td>27.3</td>
    </tr>
    <tr>
      <th>Wyre Forest 014D</th>
      <td>65.9</td>
      <td>50.9</td>
      <td>39.1</td>
      <td>27.3</td>
    </tr>
  </tbody>
</table>
<p>1787 rows √ó 4 columns</p>
</div></div></div>
</div>
<p>Run the function to find which of the units in the reduced dataframe is closest to each LSOA:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_catchment_island</span> <span class="o">=</span> <span class="n">stroke_maps</span><span class="o">.</span><span class="n">catchment</span><span class="o">.</span><span class="n">find_nearest_unit</span><span class="p">(</span><span class="n">df_travel_lsoa_here</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This dataframe contains only stroke units and LSOA within the boundary of the selected region.</p>
</section>
<section id="plots">
<h2>Plots<a class="headerlink" href="#plots" title="Permalink to this heading">#</a></h2>
<p>Turn the stroke unit catchment area dataframes into geometry data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf_catchment_acute</span> <span class="o">=</span> <span class="n">make_gdf</span><span class="p">(</span><span class="n">df_catchment_acute</span><span class="p">,</span> <span class="n">gdf_lsoa</span><span class="p">)</span>
<span class="n">gdf_catchment_island</span> <span class="o">=</span> <span class="n">make_gdf</span><span class="p">(</span><span class="n">df_catchment_island</span><span class="p">,</span> <span class="n">gdf_lsoa</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Find shared axis limits by finding the bounding box that just contains both sets of catchment areas:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bounds_acute</span> <span class="o">=</span> <span class="n">gdf_catchment_acute</span><span class="o">.</span><span class="n">total_bounds</span>
<span class="n">bounds_island</span> <span class="o">=</span> <span class="n">gdf_catchment_island</span><span class="o">.</span><span class="n">total_bounds</span>

<span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nb">min</span><span class="p">(</span><span class="n">bounds_acute</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bounds_island</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>  <span class="c1"># xmin</span>
    <span class="nb">min</span><span class="p">(</span><span class="n">bounds_acute</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bounds_island</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>  <span class="c1"># ymin</span>
    <span class="nb">max</span><span class="p">(</span><span class="n">bounds_acute</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">bounds_island</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>  <span class="c1"># xmax</span>
    <span class="nb">max</span><span class="p">(</span><span class="n">bounds_acute</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">bounds_island</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span>  <span class="c1"># ymax</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Plot the unit locations and catchment areas using matplotlib:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_catchment</span><span class="p">(</span><span class="n">gdf_catchment_acute</span><span class="p">,</span> <span class="n">gdf_isdn</span><span class="p">,</span> <span class="n">gdf_units</span><span class="p">,</span> <span class="n">postcodes_acute_units</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Nearest unit&#39;</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">)</span>
<span class="n">plot_catchment</span><span class="p">(</span><span class="n">gdf_catchment_island</span><span class="p">,</span> <span class="n">gdf_isdn</span><span class="p">,</span> <span class="n">gdf_units</span><span class="p">,</span> <span class="n">postcodes_island</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Island method&#39;</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/2d7bacd65788ebdaadcf974c1f35dc837aae9211c5f676e3b9ed7336dd02fee0.png" src="_images/2d7bacd65788ebdaadcf974c1f35dc837aae9211c5f676e3b9ed7336dd02fee0.png" />
<img alt="_images/8606bd2ca52d103b26e4699562eadc20d0f816ad97655fbd6d0299513a4520cb.png" src="_images/8606bd2ca52d103b26e4699562eadc20d0f816ad97655fbd6d0299513a4520cb.png" />
</div>
</div>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this heading">#</a></h2>
<p>We have shown how to calculate stroke unit catchment areas while pretending everything outside the selected region doesn‚Äôt exist.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="data_ref.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Data reference</p>
      </div>
    </a>
    <a class="right-next"
       href="05_maps_value.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Colour maps by continuous value</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plain-english-summary">Plain English summary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#aims">Aims</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#method">Method</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#notebook-setup">Notebook setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#load-data">Load data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#functions">Functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#method-1-nearest-stroke-unit">Method 1: nearest stroke unit</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#method-2-island">Method 2: Island</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plots">Plots</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion">Conclusion</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Anna Laws
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      ¬© Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=c5ced968eda925caa686"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=c5ced968eda925caa686"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>